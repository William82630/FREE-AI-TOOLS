{% extends 'base.html' %}

{% block title %}BMI Calculator - Calculate Your Body Mass Index Online{% endblock %}
{% block description %}Calculate your BMI (Body Mass Index) with our advanced calculator. Get personalized health advice, visual representation of your BMI category, and detailed health metrics.{% endblock %}
{% block keywords %}BMI calculator, body mass index, health calculator, weight status, BMI chart, free BMI calculator, online BMI calculator{% endblock %}

{% block hero_color %}#0d5522{% endblock %}
{% block hero_title %}BMI Calculator{% endblock %}
{% block hero_subtitle %}Calculate your Body Mass Index (BMI) instantly to assess if your weight is healthy for your height.{% endblock %}

{% block button_gradient_start %}#0d5522{% endblock %}
{% block button_gradient_end %}#083818{% endblock %}
{% block button_shadow_color %}rgba(13,85,34,0.3){% endblock %}
{% block button_shadow_hover_color %}rgba(13,85,34,0.4){% endblock %}

{% block step_title_color %}#0d5522{% endblock %}
{% block step_number_bg_color %}#0d5522{% endblock %}
{% block feature_title_color %}#0d5522{% endblock %}
{% block faq_title_color %}#0d5522{% endblock %}
{% block support_title_color %}#0d5522{% endblock %}

{% block head_scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock %}

{% block additional_styles %}
.hero {
    text-align: center;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 40px 20px;
}
.hero h1 {
    text-align: center;
    width: 100%;
    color: white;
    font-size: 2.8em;
    margin: 0 0 15px 0;
}
.hero p {
    text-align: center;
    width: 100%;
    color: white;
    font-size: 1.3em;
    max-width: 800px;
    margin: 0 auto;
    line-height: 1.5;
}
.input-group {
    margin: 30px auto 0;
    display: flex;
    flex-direction: row;
    justify-content: center;
    align-items: flex-start;
    gap: 20px;
    max-width: 500px;
}
.input-field {
    width: 100%;
    margin-bottom: 10px;
    text-align: center;
    min-width: 180px;
    max-width: 220px;
}
.input-field label {
    display: block;
    margin-bottom: 10px;
    font-size: 1.15em;
    font-weight: 500;
    color: #e0e0e0;
}
.input-field input {
    width: 100%;
    padding: 12px 10px;
    border: 2px solid #0d5522;
    border-radius: 8px;
    background: #181a20;
    color: #e0e0e0;
    font-size: 1.25em;
    box-shadow: 0 4px 12px rgba(13,85,34,0.12);
    transition: all 0.2s ease;
    text-align: center;
    margin-bottom: 10px;
    box-sizing: border-box;
}
.input-field select {
    width: 100%;
    padding: 10px 10px;
    border: 2px solid #0d5522;
    border-radius: 8px;
    background: #181a20;
    color: #e0e0e0;
    font-size: 1.15em;
    box-shadow: 0 4px 12px rgba(13,85,34,0.12);
    transition: all 0.2s ease;
    text-align: center;
    cursor: pointer;
    box-sizing: border-box;
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%230d5522' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right 10px center;
    background-size: 16px;
    padding-right: 30px;
    position: relative;
    z-index: 10;
}
.input-field input:hover, .input-field select:hover {
    border-color: #0d5522;
    box-shadow: 0 6px 16px rgba(13,85,34,0.18);
}
.input-field input:focus, .input-field select:focus {
    border: 2px solid #ffc107;
    outline: none;
    box-shadow: 0 6px 16px rgba(255,193,7,0.15);
    transform: translateY(-2px);
}
.calculate-btn {
    background: linear-gradient(90deg, #0d5522 0%, #083818 100%);
    color: white;
    padding: 16px 32px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 1.2em;
    font-weight: bold;
    width: 100%;
    max-width: 240px;
    margin: 32px auto 0 auto;
    display: block;
    box-shadow: 0 4px 12px rgba(13,85,34,0.15);
    transition: transform 0.2s, box-shadow 0.2s;
}
.calculate-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(13,85,34,0.25);
}
.error-message {
    color: #dc3545;
    display: none;
    margin: 10px auto;
    font-size: 1em;
    text-align: center;
    background: rgba(220,53,69,0.1);
    padding: 10px;
    border-radius: 6px;
    max-width: 400px;
}
.results {
    display: none;
    margin: 36px auto;
    padding: 28px;
    background: #1a1d2e;
    border-radius: 10px;
    box-shadow: 0 6px 16px rgba(0,0,0,0.15);
    text-align: center;
    border: 1px solid rgba(40,167,69,0.15);
    max-width: 500px;
    overflow: visible;
}
.results.show {
    display: block;
    animation: fadeIn 0.6s ease-out;
}
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(15px); }
    to { opacity: 1; transform: translateY(0); }
}
.bmi-value {
    font-size: 2.5em;
    font-weight: bold;
    color: #0d5522;
    margin: 15px 0;
    text-shadow: 0 2px 4px rgba(0,0,0,0.1);
}
.category-label {
    color: #e0e0e0;
    margin: 10px 0;
    font-size: 1.4em;
    font-weight: 600;
}
.health-advice {
    margin: 20px 0;
    padding: 15px;
    border-radius: 8px;
    font-size: 1.05em;
    line-height: 1.5;
}
.health-advice.underweight { background-color: rgba(255,193,7,0.15); border: 1px solid rgba(255,193,7,0.3); }
.health-advice.normal { background-color: rgba(13,85,34,0.15); border: 1px solid rgba(13,85,34,0.3); }
.health-advice.overweight { background-color: rgba(255,193,7,0.15); border: 1px solid rgba(255,193,7,0.3); }
.health-advice.obese { background-color: rgba(220,53,69,0.15); border: 1px solid rgba(220,53,69,0.3); }
.detailed-metrics {
    display: grid;
    grid-template-columns: 1fr;
    gap: 15px;
    margin-top: 20px;
}
.metric-card {
    background: #23263a;
    padding: 18px;
    margin: 5px 0;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    transition: transform 0.2s, box-shadow 0.2s;
    border: 1px solid rgba(40,167,69,0.1);
}
.metric-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 16px rgba(40,167,69,0.15);
}
.metric-card h4 {
    margin: 0 0 10px 0;
    color: #ffffff;
    font-size: 1.15em;
}
.metric-card p {
    margin: 8px 0;
    font-size: 1em;
    color: #e0e0e0;
}
.bmi-categories {
    margin: 40px auto;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 20px;
    max-width: 900px;
}
.category-card {
    background: #23263a;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    transition: transform 0.2s;
    border-top: 4px solid #0d5522;
}
.category-card:hover {
    transform: translateY(-3px);
}
.category-card h3 {
    color: #ffffff;
    margin-top: 0;
    font-size: 1.2em;
}
.category-card p {
    color: #e0e0e0;
    line-height: 1.5;
}
.category-card ul {
    padding-left: 20px;
    color: #e0e0e0;
}
.category-card li {
    margin-bottom: 8px;
}
.calculator-container {
    background: #23263a;
    border-radius: 12px;
    box-shadow: 0 8px 24px rgba(0,0,0,0.25);
    padding: 38px 32px 40px 32px;
    margin: 0 auto;
    max-width: 600px;
    min-width: 320px;
    border: 1px solid rgba(40,167,69,0.1);
    position: relative;
    overflow: hidden;
    text-align: center;
}
.calculator-container::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 4px;
    background: linear-gradient(90deg, #0d5522, #083818);
}
.gauge-container {
    position: relative;
    width: 100%;
    max-width: 300px;
    height: 150px;
    margin: 0 auto 20px;
}
.bmi-pointer {
    position: absolute;
    bottom: 0;
    left: 50%;
    width: 2px;
    height: 80px;
    background-color: #dc3545;
    transform-origin: bottom center;
    transform: translateX(-50%) rotate(0deg);
    transition: transform 1s ease-out;
    z-index: 10;
}
.bmi-pointer::after {
    content: '';
    position: absolute;
    top: 0;
    left: -4px;
    width: 10px;
    height: 10px;
    background-color: #dc3545;
    border-radius: 50%;
}
.reset-btn {
    background: #333;
    color: white;
    border: none;
    border-radius: 8px;
    padding: 12px 24px;
    margin-top: 20px;
    cursor: pointer;
    font-size: 1em;
    transition: background 0.2s;
    display: inline-flex;
    align-items: center;
    gap: 8px;
}
.reset-btn:hover {
    background: #444;
}
.reset-btn svg {
    width: 16px;
    height: 16px;
}
/* FAQ Accordion Styles */
.faq-item {
    margin-bottom: 15px;
    border: 1px solid #333;
    border-radius: 8px;
    overflow: hidden;
    background-color: #23263a;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}
.faq-question {
    padding: 15px 20px;
    background-color: #1a1d2e;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: background-color 0.3s;
}
.faq-question:hover {
    background-color: #2a2e45;
}
.faq-question h3 {
    margin: 0;
    font-size: 1.1em;
    color: #ffffff;
}
.faq-question i {
    color: #ffffff;
    transition: transform 0.3s;
}
.faq-answer {
    padding: 20px;
    background-color: #23263a;
    color: #e0e0e0;
}
.faq-item.active .faq-question {
    background-color: #2a2e45;
}
.faq-item.active .faq-question i {
    transform: rotate(180deg);
}

@media (max-width: 768px) {
    .input-group {
        flex-direction: column;
        align-items: center;
    }
    .input-field {
        width: 100%;
        max-width: 280px;
    }
}
{% endblock %}

{% block content %}
<div class="input-section">
    <div class="calculator-container">
        <div class="input-group">
            <div class="input-field">
                <label>Height:</label>
                <input type="number" id="height" placeholder="Enter height" style="font-size: 1.1em; width: 100%;">
                <select id="heightUnit" style="width: 100%;">
                    <option value="cm">Centimeters</option>
                    <option value="feet">Feet</option>
                    <option value="inches">Inches</option>
                </select>
            </div>
            <div class="input-field">
                <label>Weight:</label>
                <input type="number" id="weight" placeholder="Enter weight" style="font-size: 1.1em; width: 100%;">
                <select id="weightUnit" style="width: 100%;">
                    <option value="kg">Kilograms</option>
                    <option value="pounds">Pounds</option>
                </select>
            </div>
        </div>

        <div id="inchesField" class="input-field" style="display: none; margin: 0 auto 20px; max-width: 220px;">
            <label>Additional inches:</label>
            <input type="number" id="heightInches" placeholder="Inches" style="font-size: 1.1em; width: 100%;">
        </div>

        <div id="inputError" class="error-message"></div>
        <button class="calculate-btn" onclick="calculateBMI()">Calculate BMI</button>

        <div class="results" id="results">
            <h2>YOUR BMI RESULT</h2>
            <div class="gauge-container">
                <canvas id="bmiGauge"></canvas>
                <div class="bmi-pointer" id="bmiPointer"></div>
            </div>
            <div id="bmiResult"></div>
            <div id="healthAdvice" class="health-advice"></div>
            <div class="detailed-metrics" id="detailedMetrics"></div>

            <button class="reset-btn" onclick="resetCalculator()">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path>
                    <path d="M3 3v5h5"></path>
                </svg>
                Calculate Again
            </button>
        </div>
    </div>
</div>

<div class="how-to" style="max-width: 900px; margin: 60px auto 40px;">
    <h2 style="text-align: center; margin-bottom: 30px; color: #fff;">How to Use Our BMI Calculator</h2>
    <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 16px; margin-top: 28px;">
        <div style="flex: 1 1 220px; max-width: 260px; min-width: 200px; margin: 0; background: #23263a; color: #fff; padding: 20px 15px; border-radius: 12px; box-sizing: border-box; position: relative;">
            <div style="position: absolute; top: -15px; left: 50%; transform: translateX(-50%); width: 40px; height: 40px; line-height: 40px; background-color: #0d5522; color: white; border-radius: 50%; font-size: 1.3em; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.2);">1</div>
            <h3 style="color:#fff; margin-top: 20px; text-align: center; font-size: 1.2em;">Enter Your Height</h3>
            <p style="text-align:center; color:#e0e0e0; font-size:0.95em;">Input your height and select the unit (centimeters, feet, or inches). If you choose feet, you can add additional inches for precision.</p>
        </div>
        <div style="flex: 1 1 220px; max-width: 260px; min-width: 200px; margin: 0; background: #23263a; color: #fff; padding: 20px 15px; border-radius: 12px; box-sizing: border-box; position: relative;">
            <div style="position: absolute; top: -15px; left: 50%; transform: translateX(-50%); width: 40px; height: 40px; line-height: 40px; background-color: #0d5522; color: white; border-radius: 50%; font-size: 1.3em; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.2);">2</div>
            <h3 style="color:#fff; margin-top: 20px; text-align: center; font-size: 1.2em;">Enter Your Weight</h3>
            <p style="text-align:center; color:#e0e0e0; font-size:0.95em;">Input your weight and select the unit (kilograms or pounds). Our calculator will automatically convert to the appropriate units for BMI calculation.</p>
        </div>
        <div style="flex: 1 1 220px; max-width: 260px; min-width: 200px; margin: 0; background: #23263a; color: #fff; padding: 20px 15px; border-radius: 12px; box-sizing: border-box; position: relative;">
            <div style="position: absolute; top: -15px; left: 50%; transform: translateX(-50%); width: 40px; height: 40px; line-height: 40px; background-color: #0d5522; color: white; border-radius: 50%; font-size: 1.3em; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.2);">3</div>
            <h3 style="color:#fff; margin-top: 20px; text-align: center; font-size: 1.2em;">View Detailed Results</h3>
            <p style="text-align:center; color:#e0e0e0; font-size:0.95em;">Get your BMI score, weight category, personalized health advice, and additional metrics like healthy weight range and BMI Prime.</p>
        </div>
    </div>
</div>

<div class="understanding-bmi" style="max-width: 900px; margin: 40px auto; background: #23263a; padding: 30px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
    <h2 style="color: #ffffff; margin-top: 0;">Understanding Your BMI</h2>
    <p style="color: #e0e0e0; line-height: 1.6;">BMI, or Body Mass Index, is a simple way to assess whether someone's weight is appropriate for their height. It gives a rough estimate of body fat and is commonly used as a general indicator of whether a person is underweight, at a healthy weight, overweight, or obese. The BMI value is calculated using a person's height and weight, and the resulting number falls into specific categories that help identify potential health risks.</p>

    <p style="color: #e0e0e0; line-height: 1.6;">These categories can vary slightly depending on factors like age and region. While BMI doesn't measure body fat directly and isn't a perfect health metric, it's a useful tool for identifying whether further health assessments might be needed, especially if someone falls outside the normal range. Being significantly under or overweight can impact overall health, so understanding your BMI can be a helpful first step in monitoring well-being.</p>
</div>

<div class="features">
    <h2>BMI Categories and Recommendations</h2>
    <div class="bmi-categories">
        <div class="category-card">
            <h3>Underweight (BMI < 18.5)</h3>
            <p>Being underweight might indicate malnutrition or other health issues.</p>
            <strong style="color: #e0e0e0;">Recommendations:</strong>
            <ul>
                <li>Increase caloric intake with nutritious foods</li>
                <li>Include protein-rich foods in your diet</li>
                <li>Consider consulting a healthcare provider</li>
            </ul>
        </div>
        <div class="category-card">
            <h3>Normal Weight (BMI 18.5-24.9)</h3>
            <p>This is the healthy range. Your weight is proportional to your height.</p>
            <strong style="color: #e0e0e0;">Recommendations:</strong>
            <ul>
                <li>Maintain your balanced diet</li>
                <li>Regular exercise (150 minutes/week)</li>
                <li>Regular health check-ups</li>
            </ul>
        </div>
        <div class="category-card">
            <h3>Overweight (BMI 25-29.9)</h3>
            <p>Being overweight may increase your risk of health problems.</p>
            <strong style="color: #e0e0e0;">Recommendations:</strong>
            <ul>
                <li>Gradually reduce caloric intake</li>
                <li>Increase physical activity</li>
                <li>Focus on portion control</li>
            </ul>
        </div>
        <div class="category-card">
            <h3>Obese (BMI ≥ 30)</h3>
            <p>Obesity significantly increases risk of various health conditions.</p>
            <strong style="color: #e0e0e0;">Recommendations:</strong>
            <ul>
                <li>Consult healthcare provider</li>
                <li>Create a structured weight loss plan</li>
                <li>Regular exercise under guidance</li>
            </ul>
        </div>
    </div>
</div>

<div class="faq">
    <h2>Frequently Asked Questions</h2>

    <div class="faq-item">
        <div class="faq-question">
            <h3>Is BMI accurate for everyone?</h3>
            <i class="fas fa-chevron-down"></i>
        </div>
        <div class="faq-answer">
            <p>BMI is not a perfect measure for everyone. It may not be as accurate for athletes, elderly people, or those with high muscle mass, as it doesn't distinguish between weight from muscle and weight from fat.</p>
        </div>
    </div>

    <div class="faq-item">
        <div class="faq-question">
            <h3>How often should I check my BMI?</h3>
            <i class="fas fa-chevron-down"></i>
        </div>
        <div class="faq-answer">
            <p>It's recommended to check your BMI every 3-6 months, or whenever there's a significant change in your weight or lifestyle. Regular monitoring can help track trends in your weight status.</p>
        </div>
    </div>

    <div class="faq-item">
        <div class="faq-question">
            <h3>Why might my BMI be high even though I exercise regularly?</h3>
            <i class="fas fa-chevron-down"></i>
        </div>
        <div class="faq-answer">
            <p>If you're very muscular, your BMI might be high even if you're not overweight. This is because muscle is denser than fat, and BMI doesn't account for body composition.</p>
        </div>
    </div>

    <div class="faq-item">
        <div class="faq-question">
            <h3>Can BMI predict health problems?</h3>
            <i class="fas fa-chevron-down"></i>
        </div>
        <div class="faq-answer">
            <p>While BMI can indicate potential health risks, it's just one of many factors. Other measurements like waist circumference, blood pressure, and blood sugar levels are also important indicators of overall health.</p>
        </div>
    </div>

    <div class="faq-item">
        <div class="faq-question">
            <h3>Does BMI calculation differ for children?</h3>
            <i class="fas fa-chevron-down"></i>
        </div>
        <div class="faq-answer">
            <p>Yes, BMI for children and teens (aged 2-20) is calculated the same way but interpreted differently. It's compared to typical values for other children of the same age and sex using specific growth charts.</p>
        </div>
    </div>

    <div class="faq-item">
        <div class="faq-question">
            <h3>What should I do if my BMI is outside the healthy range?</h3>
            <i class="fas fa-chevron-down"></i>
        </div>
        <div class="faq-answer">
            <p>If your BMI is outside the healthy range (18.5-24.9), it's recommended to consult with a healthcare provider. They can evaluate your individual situation and recommend appropriate lifestyle changes or medical interventions if needed.</p>
        </div>
    </div>
</div>


{% endblock %}

{% block body_scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('heightUnit').addEventListener('change', function() {
            document.getElementById('inchesField').style.display =
                this.value === 'feet' ? 'block' : 'none';
        });

        // Initialize the BMI gauge on page load
        updateBMIGauge(0);

        // Initialize FAQ accordion
        // Hide all answers initially
        document.querySelectorAll('.faq-answer').forEach(answer => {
            answer.style.display = 'none';
        });

        // Set first FAQ item as active by default
        const firstFaqItem = document.querySelector('.faq-item');
        if (firstFaqItem) {
            firstFaqItem.classList.add('active');
            const firstFaqAnswer = firstFaqItem.querySelector('.faq-answer');
            if (firstFaqAnswer) {
                firstFaqAnswer.style.display = 'block';
            }
        }

        // Add click event listeners to all FAQ questions
        document.querySelectorAll('.faq-question').forEach(question => {
            question.addEventListener('click', function() {
                const faqItem = this.parentElement;
                const answer = faqItem.querySelector('.faq-answer');
                const icon = this.querySelector('i');

                // Close all other FAQ items
                document.querySelectorAll('.faq-item').forEach(item => {
                    if (item !== faqItem) {
                        const itemAnswer = item.querySelector('.faq-answer');
                        const itemIcon = item.querySelector('.faq-question i');
                        if (itemAnswer) itemAnswer.style.display = 'none';
                        if (itemIcon) itemIcon.style.transform = 'rotate(0deg)';
                        item.classList.remove('active');
                    }
                });

                // Toggle current FAQ item
                if (answer.style.display === 'block') {
                    answer.style.display = 'none';
                    if (icon) icon.style.transform = 'rotate(0deg)';
                    faqItem.classList.remove('active');
                } else {
                    answer.style.display = 'block';
                    if (icon) icon.style.transform = 'rotate(180deg)';
                    faqItem.classList.add('active');
                }
            });
        });
    });

    // Add input validation
    function validateInputs() {
        const height = parseFloat(document.getElementById('height').value);
        const weight = parseFloat(document.getElementById('weight').value);
        const heightUnit = document.getElementById('heightUnit').value;
        const heightInches = heightUnit === 'feet' ? parseFloat(document.getElementById('heightInches').value) || 0 : 0;

        let isValid = true;
        let errorMessage = '';

        if (isNaN(height) || height <= 0) {
            errorMessage = 'Please enter a valid height';
            isValid = false;
        } else if (heightUnit === 'cm' && (height < 50 || height > 300)) {
            errorMessage = 'Height should be between 50cm and 300cm';
            isValid = false;
        } else if (heightUnit === 'feet' && (height < 2 || height > 8)) {
            errorMessage = 'Height should be between 2ft and 8ft';
            isValid = false;
        }

        if (isNaN(weight) || weight <= 0) {
            errorMessage = 'Please enter a valid weight';
            isValid = false;
        } else if (weight < 20 || weight > 500) {
            errorMessage = 'Weight should be between 20 and 500';
            isValid = false;
        }

        const errorElement = document.getElementById('inputError');
        errorElement.style.display = isValid ? 'none' : 'block';
        errorElement.textContent = errorMessage;

        return isValid;
    }

    function calculateBMI() {
        if (!validateInputs()) return;

        let height = parseFloat(document.getElementById('height').value);
        let weight = parseFloat(document.getElementById('weight').value);
        const heightUnit = document.getElementById('heightUnit').value;
        const weightUnit = document.getElementById('weightUnit').value;

        // Convert height to meters
        if (heightUnit === 'cm') {
            height = height / 100;
        } else if (heightUnit === 'feet') {
            const inches = parseFloat(document.getElementById('heightInches').value) || 0;
            height = (height * 12 + inches) * 0.0254;
        } else if (heightUnit === 'inches') {
            height = height * 0.0254;
        }

        // Convert weight to kg
        if (weightUnit === 'pounds') {
            weight = weight * 0.453592;
        }

        const bmi = weight / (height * height);
        displayResults(bmi);
    }

    function displayResults(bmi) {
        const results = document.getElementById('results');
        const bmiResult = document.getElementById('bmiResult');
        const healthAdvice = document.getElementById('healthAdvice');
        const detailedMetrics = document.getElementById('detailedMetrics');

        // Make sure results are visible
        results.style.display = 'block';

        // Add show class for animation
        results.classList.add('show');

        // Update BMI gauge and pointer
        setTimeout(() => {
            updateBMIGauge(bmi);
            updateBMIPointer(bmi);
        }, 100);

        // Calculate additional metrics
        const heightInMeters = getHeightInMeters();
        const weightInKg = getWeightInKg();
        const bmiPrime = bmi / 25;
        const ponderalIndex = weightInKg / Math.pow(heightInMeters, 3);

        // Calculate healthy weight range
        const minHealthyWeight = 18.5 * Math.pow(heightInMeters, 2);
        const maxHealthyWeight = 25 * Math.pow(heightInMeters, 2);
        const minHealthyWeightLbs = minHealthyWeight * 2.20462;
        const maxHealthyWeightLbs = maxHealthyWeight * 2.20462;

        // Calculate weight to lose/gain
        const weightDiff = weightInKg - (25 * Math.pow(heightInMeters, 2));
        const weightDiffLbs = weightDiff * 2.20462;

        // Display BMI value and category
        let category, advice, adviceClass;
        if (bmi < 18.5) {
            category = 'Underweight';
            advice = 'You are underweight. Consider increasing your caloric intake with nutritious foods and consult a healthcare provider for personalized advice.';
            adviceClass = 'underweight';
        } else if (bmi < 25) {
            category = 'Normal Weight';
            advice = 'Congratulations! You are at a healthy weight. Maintain your balanced diet and regular exercise routine.';
            adviceClass = 'normal';
        } else if (bmi < 30) {
            category = 'Overweight';
            advice = 'You are overweight. Consider making lifestyle changes such as improving diet and increasing physical activity.';
            adviceClass = 'overweight';
        } else {
            category = 'Obese';
            advice = 'Your BMI indicates obesity. Please consult a healthcare provider for professional guidance on weight management.';
            adviceClass = 'obese';
        }

        bmiResult.innerHTML = `
            <div class="bmi-value">${bmi.toFixed(1)}</div>
            <h3 class="category-label">${category}</h3>
        `;
        healthAdvice.className = `health-advice ${adviceClass}`;
        healthAdvice.innerHTML = `<p>${advice}</p>`;

        // Display detailed metrics
        detailedMetrics.innerHTML = `
            <div class="metric-card">
                <h4>Healthy Weight Range</h4>
                <p>${minHealthyWeightLbs.toFixed(1)} - ${maxHealthyWeightLbs.toFixed(1)} lbs</p>
                <p>(${minHealthyWeight.toFixed(1)} - ${maxHealthyWeight.toFixed(1)} kg)</p>
            </div>
            ${weightDiff !== 0 ? `
            <div class="metric-card">
                <h4>Weight Goal</h4>
                <p>${weightDiff > 0
                    ? `Lose ${weightDiffLbs.toFixed(1)} lbs to reach a healthy BMI`
                    : `Gain ${Math.abs(weightDiffLbs).toFixed(1)} lbs to reach a healthy BMI`
                }</p>
            </div>` : ''}
            <div class="metric-card">
                <h4>Additional Metrics</h4>
                <p>BMI Prime: ${bmiPrime.toFixed(2)}</p>
                <p>Ponderal Index: ${ponderalIndex.toFixed(1)} kg/m³</p>
            </div>
        `;
    }

    function resetCalculator() {
        // Clear inputs
        document.getElementById('height').value = '';
        document.getElementById('weight').value = '';
        if (document.getElementById('heightInches')) {
            document.getElementById('heightInches').value = '';
        }

        // Hide results
        const results = document.getElementById('results');
        results.classList.remove('show');

        // Clear error message
        const errorElement = document.getElementById('inputError');
        errorElement.style.display = 'none';

        // Reset BMI gauge
        updateBMIGauge(0);
        updateBMIPointer(0);

        // Focus on height input
        document.getElementById('height').focus();
    }

    function updateBMIGauge(bmi) {
        const ctx = document.getElementById('bmiGauge').getContext('2d');

        if (window.bmiGaugeChart) {
            window.bmiGaugeChart.destroy();
        }

        window.bmiGaugeChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                datasets: [{
                    data: [18.5, 6.5, 5, 10],
                    backgroundColor: ['#ffc107', '#0d5522', '#fd7e14', '#dc3545'],
                    circumference: 180,
                    rotation: 270,
                }],
                labels: ['< 18.5 Underweight', '18.5-25 Normal', '25-30 Overweight', '> 30 Obese']
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                cutout: '70%',
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            color: '#e0e0e0',
                            boxWidth: 12,
                            padding: 10,
                            font: {
                                size: 11
                            }
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.label;
                            }
                        }
                    }
                }
            }
        });
    }

    function updateBMIPointer(bmi) {
        const pointer = document.getElementById('bmiPointer');
        // Calculate rotation angle based on BMI
        let angle = 0;
        if (bmi < 18.5) {
            angle = -90 + (bmi / 18.5 * 45);
        } else if (bmi < 25) {
            angle = -45 + ((bmi - 18.5) / 6.5 * 45);
        } else if (bmi < 30) {
            angle = ((bmi - 25) / 5 * 45);
        } else {
            angle = 45 + Math.min((bmi - 30) / 10 * 45, 45);
        }
        pointer.style.transform = `rotate(${angle}deg)`;
    }

    function getHeightInMeters() {
        let height = parseFloat(document.getElementById('height').value);
        const heightUnit = document.getElementById('heightUnit').value;

        if (heightUnit === 'cm') {
            return height / 100;
        } else if (heightUnit === 'feet') {
            const inches = parseFloat(document.getElementById('heightInches').value) || 0;
            return (height * 12 + inches) * 0.0254;
        } else if (heightUnit === 'inches') {
            return height * 0.0254;
        }
        return height;
    }

    function getWeightInKg() {
        let weight = parseFloat(document.getElementById('weight').value);
        const weightUnit = document.getElementById('weightUnit').value;

        if (weightUnit === 'pounds') {
            return weight * 0.453592;
        }
        return weight;
    }
</script>
{% endblock %}